var Polling=require("./polling");var qs=require("querystring");var rDoubleSlashes=/\\\\n/g;var rSlashes=/(\\)?\\n/g;var util=require("util");module.exports=JSONP;function JSONP(a){Polling.call(this,a);this.head="___eio["+(a._query.j||"").replace(/[^0-9]/g,"")+"](";this.foot=");"}util.inherits(JSONP,Polling);JSONP.prototype.onData=function(a){a=qs.parse(a).d;if("string"===typeof a){a=a.replace(rSlashes,function(b,c){return c?b:"\n"});Polling.prototype.onData.call(this,a.replace(rDoubleSlashes,"\\n"))}};JSONP.prototype.doWrite=function(b,a,d){var c=JSON.stringify(b).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029");b=this.head+c+this.foot;Polling.prototype.doWrite.call(this,b,a,d)};